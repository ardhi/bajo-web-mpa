{% cmp 'buttonToolbar', margin='bottom5', justifyContent='between' %}
  {% cmp 'form', display='flex', role='search' %}
    {% cmp 'input', name='query', margin='end2', type='search', placeholder='Search'|t, ariaLabel='Search', value=_meta.query.query %}{% endcmp %}
  {% endcmp %}
  {% cmp 'crudButtons', route=attr.baseRoute, id=attr.baseId %}{% endcmp %}
  {% cmp 'viewTypeButtons', view=attr.view, types=['table', 'gridSmall', 'grid'] %}{% endcmp %}
{% endcmp %}

{% script %}
<script>
  const btnDetail = $('#{{ attr.baseId }}-buttons-detail')
  const btnEdit = $('#{{ attr.baseId }}-buttons-edit')
  const btnDelete = $('#{{ attr.baseId }}-buttons-delete')
  const toggler = $('#{{ attr.baseId }} .check-toggler')
  function updateUi () {
    const all = $('#{{ attr.baseId }} tbody tr input[type=checkbox]')
    const checked = $('#{{ attr.baseId }} tbody tr input[type=checkbox]:checked')
    if (checked.length === 0) {
      toggler.prop('checked', false)
      btnDetail.addClass('disabled').removeAttr('href')
      btnEdit.addClass('disabled').removeAttr('href')
      btnDelete.addClass('disabled')
    } else if (checked.length === 1) {
      const rowId = checked.val()
      btnDetail.removeClass('disabled').attr('href', btnDetail.data('href') + rowId)
      btnEdit.removeClass('disabled').attr('href', btnEdit.data('href') + rowId)
      btnDelete.removeClass('disabled')
    } else if (checked.length === all.length) {
      toggler.prop('checked', true)
      btnDetail.addClass('disabled').removeAttr('href')
      btnEdit.addClass('disabled').removeAttr('href')
      btnDelete.removeClass('disabled')
    } else {
      btnDetail.addClass('disabled').removeAttr('href')
      btnEdit.addClass('disabled').removeAttr('href')
      btnDelete.removeClass('disabled')
    }
  }
  btnDelete.on('click', function () {
    const ids = []
    $('#{{ attr.baseId }} tbody tr input[type=checkbox]:checked').each(function () {
      ids.push($(this).val())
    })
    if (ids.length === 0) return
    bootbox.confirm({
      message: "{{ 'You\'re about to delete one or more records. Are you sure?'|t }}",
      callback: function (result) {
        console.log(result)
      }
    })
  })

  $('#{{ attr.baseId }} tbody tr').on('click', function () {
    const el = $(this).find('input[type=checkbox]')
    if (!el) return
    el.prop('checked', !el.prop('checked'))
    updateUi()
  })
  $('#{{ attr.baseId }} tbody tr').on('dblclick', function () {
    const rowId = $(this).find('input[type=checkbox]').val()
    location.href='{{ routePath(attr.baseRoute + '/detail/', { params: _meta.params }) }}' + rowId
  })
  $('#{{ attr.baseId }} .check-toggler').on('change', function () {
    $('#{{ attr.baseId }} tbody tr input[type=checkbox]').prop('checked', $(this).is(':checked'))
    updateUi()
  })
  $('#{{ attr.baseId }} tbody tr input[type=checkbox]').on('click', function (evt) {
    evt.stopPropagation()
  })
  $('#{{ attr.baseId }} tbody tr input[type=checkbox]').on('change', function () {
    updateUi()
  })
</script>
{% endscript %}